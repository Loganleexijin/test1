
# æ–­é£Ÿå®Œæˆ/æå‰ç»“æŸäº¤äº’è®¾è®¡æ–¹æ¡ˆ

## æ¦‚è¿°

æœ¬æ–¹æ¡ˆä¸ºã€Œè½»æ–­é£Ÿ Appã€å®ç°ä¸¤ç§æ–­é£Ÿç»“æŸåœºæ™¯çš„äº¤äº’è®¾è®¡ï¼š
1. **å®Œæˆè®¡åˆ’** - è¾¾åˆ°æˆ–è¶…è¿‡ç›®æ ‡æ—¶é•¿åç»“æŸï¼Œè§¦å‘åº†ç¥åŠ¨ç”»å’Œå…¨å±ç»“æœå¡
2. **æå‰ç»“æŸ** - æœªè¾¾ç›®æ ‡ä½†è¶…è¿‡30åˆ†é’Ÿæ—¶ä¸»åŠ¨ç»“æŸï¼Œè§¦å‘åº•éƒ¨ç¡®è®¤æŠ½å±‰

---

## ä¸€ã€æ–°å¢ç»„ä»¶æ¦‚è§ˆ

| ç»„ä»¶ | è·¯å¾„ | ç”¨é€” |
|------|------|------|
| `FastingCompleteSheet` | `src/components/fasting/FastingCompleteSheet.tsx` | å…¨å±åº†ç¥ç»“æœå¡ï¼ˆå®Œæˆè®¡åˆ’æ—¶è§¦å‘ï¼‰ |
| `EarlyEndDrawer` | `src/components/fasting/EarlyEndDrawer.tsx` | åº•éƒ¨ç¡®è®¤æŠ½å±‰ï¼ˆæå‰ç»“æŸæ—¶è§¦å‘ï¼‰ |

---

## äºŒã€ç»„ä»¶è¯¦ç»†è®¾è®¡

### 2.1 å®Œæˆè®¡åˆ’ - å…¨å±ç»“æœå¡ (FastingCompleteSheet)

**è§¦å‘æ¡ä»¶ï¼š**
- æ–­é£Ÿæ—¶é•¿ >= ç›®æ ‡æ—¶é•¿ï¼ˆå¦‚ 16 å°æ—¶ï¼‰æ—¶ç‚¹å‡»ã€Œç»“æŸæ–­é£Ÿã€
- æˆ–å€’è®¡æ—¶å½’é›¶æ—¶è‡ªåŠ¨è§¦å‘

**UI ç»“æ„ï¼š**

```text
+--------------------------------------+
|  â˜… â˜… â˜… (é‡‘è‰²æ˜Ÿæ˜Ÿè½ä¸‹åŠ¨ç”»)            |
|                                      |
|      ğŸ‰ æ–­é£Ÿå®Œæˆï¼                    |
|   æ­å–œä½ å®Œæˆäº† 16:8 æ–­é£Ÿè®¡åˆ’          |
|                                      |
|  +--------------------------------+  |
|  |  æœ¬æ¬¡æ–­é£Ÿæ—¶é•¿                   |  |
|  |     16å°æ—¶02åˆ†é’Ÿ               |  |
|  |  å®Œæˆç‡  100%                  |  |
|  +--------------------------------+  |
|                                      |
|  +--------------------------------+  |
|  |  ğŸ† è§£é”æ–°å‹‹ç« ï¼šåšæŒä¸€å‘¨        |  | (æ¡ä»¶æ˜¾ç¤º)
|  +--------------------------------+  |
|                                      |
|  ä½ çš„èº«ä½“å·²è¿›å…¥æ·±åº¦ä¿®å¤é˜¶æ®µï¼Œ         |
|  ç»†èƒæ­£åœ¨è‡ªæˆ‘æ›´æ–°ã€‚ç»§ç»­ä¿æŒï¼         |
|                                      |
|         æŸ¥çœ‹è¯¦æƒ… (ç°è‰²æ–‡å­—)           |
|  +--------------------------------+  |
|  |       å¼€å§‹è¿›é£Ÿ                  |  | (é»‘åº•ç™½å­—)
|  +--------------------------------+  |
+--------------------------------------+
```

**Props æ¥å£ï¼š**
```typescript
interface FastingCompleteSheetProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  fastingDuration: { hours: number; minutes: number };
  targetHours: number;
  planType: string; // å¦‚ "16:8"
  newBadge?: { id: string; name: string; icon: string } | null;
  onStartEating: () => void;
  onViewDetails: () => void;
}
```

**è§†è§‰ç»†èŠ‚ï¼š**
- ä»åº•éƒ¨å…¨å±ä¸Šæ¨åŠ¨ç”»ï¼ˆä½¿ç”¨ Tailwind animate-slide-upï¼‰
- é‡‘è‰²æ˜Ÿæ˜ŸåŠ¨ç”»ï¼š3-5 é¢—æ˜Ÿä»é¡¶éƒ¨éšæœºä½ç½®è½ä¸‹å¹¶æ¶ˆå¤±
- å®Œæˆç‡æ•°æ®å¡ç‰‡ï¼šç™½è‰²åœ†è§’å¡ç‰‡ï¼Œå¤§å­—å·æ•°å­—
- å‹‹ç« å¥–åŠ±å¡ç‰‡ï¼šæ©™è‰²èƒŒæ™¯ï¼ˆbreakfast è‰²ï¼‰ï¼Œæ¡ä»¶æ¸²æŸ“
- ä¸»æŒ‰é’®å›ºå®šåœ¨åº•éƒ¨ï¼Œé»‘è‰²èƒŒæ™¯ç™½è‰²æ–‡å­—

---

### 2.2 æå‰ç»“æŸ - åº•éƒ¨ç¡®è®¤æŠ½å±‰ (EarlyEndDrawer)

**è§¦å‘æ¡ä»¶ï¼š**
- æ–­é£Ÿæ—¶é•¿ > 30 åˆ†é’Ÿ ä½† < ç›®æ ‡æ—¶é•¿æ—¶ç‚¹å‡»ã€Œç»“æŸæ–­é£Ÿã€

**UI ç»“æ„ï¼š**

```text
+--------------------------------------+
|        æå‰ç»“æŸæ–­é£Ÿï¼Ÿ                 |
|                                      |
|  ä½ å·²åšæŒ 8å°æ—¶15åˆ†é’Ÿï¼Œ               |
|  è·ç¦»ç›®æ ‡è¿˜æœ‰ 7å°æ—¶45åˆ†é’Ÿã€‚            |
|  ç¡®å®šè¦ç»“æŸå—ï¼Ÿ                       |
|                                      |
|  åŸå› é€‰æ‹©ï¼ˆå¯é€‰ï¼‰ï¼š                    |
|  â—‹ æ„Ÿåˆ°ä¸é€‚                          |
|  â—‹ æœ‰èšé¤å®‰æ’                         |
|  â—‹ å…¶ä»–åŸå›                            |
|                                      |
|  +--------------------------------+  |
|  |       ç»§ç»­åšæŒ                  |  | (é»‘åº•ç™½å­—)
|  +--------------------------------+  |
|         ç¡®è®¤ç»“æŸ (çº¢è‰²æ–‡å­—)           |
+--------------------------------------+
```

**Props æ¥å£ï¼š**
```typescript
interface EarlyEndDrawerProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  currentDuration: { hours: number; minutes: number };
  targetHours: number;
  onContinue: () => void;
  onConfirmEnd: (reason?: string) => void;
}
```

**è§†è§‰ç»†èŠ‚ï¼š**
- åº•éƒ¨æŠ½å±‰ï¼Œåœ†è§’é¡¶éƒ¨ï¼ˆrounded-t-3xlï¼‰
- åŸå› é€‰æ‹©ä¸ºå•é€‰æŒ‰é’®ç»„ï¼Œå¯é€‰å¡«
- ä¸»æŒ‰é’®ã€Œç»§ç»­åšæŒã€ä¸ºé»‘åº•ç™½å­—ï¼Œçªå‡ºé¼“åŠ±ç”¨æˆ·å®Œæˆç›®æ ‡
- æ¬¡æŒ‰é’®ã€Œç¡®è®¤ç»“æŸã€ä¸ºçº¢è‰²æ–‡å­—ï¼Œä½œä¸ºè­¦ç¤ºæ€§æ“ä½œ
- ç¡®è®¤ç»“æŸåæ˜¾ç¤º Toastï¼šã€Œå·²è®°å½•æœ¬æ¬¡æ–­é£Ÿï¼ˆ8å°æ—¶15åˆ†é’Ÿï¼‰ï¼Œä¸‹æ¬¡ç»§ç»­åŠ æ²¹ï¼ã€

---

## ä¸‰ã€çŠ¶æ€ç®¡ç†æ‰©å±•

åœ¨ `userStore.ts` æˆ–æ–°å»º `fastingStore.ts` ä¸­æ·»åŠ ï¼š

```typescript
// æ–°å¢ UI çŠ¶æ€
showFastingComplete: boolean;
showEarlyEndConfirm: boolean;

// æ–°å¢ Actions
setShowFastingComplete: (show: boolean) => void;
setShowEarlyEndConfirm: (show: boolean) => void;
```

---

## å››ã€FastingCard äº¤äº’é€»è¾‘æ›´æ–°

åœ¨ã€Œç»“æŸæ–­é£Ÿã€æŒ‰é’®ç‚¹å‡»æ—¶ï¼Œæ·»åŠ æ¡ä»¶åˆ¤æ–­ï¼š

```typescript
const handleEndFasting = () => {
  const totalMinutes = fastingHours * 60 + fastingMinutes;
  const targetMinutes = targetHours * 60;
  
  if (totalMinutes >= targetMinutes) {
    // è¾¾æˆç›®æ ‡ â†’ æ˜¾ç¤ºå…¨å±åº†ç¥å¡
    setShowFastingComplete(true);
  } else if (totalMinutes > 30) {
    // è¶…è¿‡30åˆ†é’Ÿä½†æœªè¾¾æ ‡ â†’ æ˜¾ç¤ºç¡®è®¤æŠ½å±‰
    setShowEarlyEndConfirm(true);
  } else {
    // å°‘äº30åˆ†é’Ÿ â†’ å¯èƒ½éœ€è¦å…¶ä»–å¤„ç†æˆ–ç›´æ¥å–æ¶ˆ
    // æ ¹æ®éœ€æ±‚å¯æ·»åŠ  Toast æç¤º
  }
};
```

---

## äº”ã€åŠ¨ç”»ä¸æ ·å¼

### 5.1 æ–°å¢ CSS åŠ¨ç”»ï¼ˆindex.cssï¼‰

```css
/* æ˜Ÿæ˜Ÿè½ä¸‹åŠ¨ç”» */
@keyframes star-fall {
  0% {
    opacity: 0;
    transform: translateY(-20px) rotate(0deg);
  }
  20% {
    opacity: 1;
  }
  100% {
    opacity: 0;
    transform: translateY(60px) rotate(360deg);
  }
}

.animate-star-fall {
  animation: star-fall 1.5s ease-out forwards;
}
```

### 5.2 Tailwind é…ç½®æ‰©å±•ï¼ˆtailwind.config.tsï¼‰

```typescript
keyframes: {
  // æ·»åŠ æ–°åŠ¨ç”»
  "star-fall": {
    "0%": { opacity: "0", transform: "translateY(-20px) rotate(0deg)" },
    "20%": { opacity: "1" },
    "100%": { opacity: "0", transform: "translateY(60px) rotate(360deg)" },
  },
},
animation: {
  "star-fall": "star-fall 1.5s ease-out forwards",
}
```

---

## å…­ã€æ–‡ä»¶å˜æ›´æ¸…å•

| æ–‡ä»¶ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| `src/components/fasting/FastingCompleteSheet.tsx` | æ–°å»º | å…¨å±åº†ç¥ç»“æœå¡ç»„ä»¶ |
| `src/components/fasting/EarlyEndDrawer.tsx` | æ–°å»º | æå‰ç»“æŸç¡®è®¤æŠ½å±‰ç»„ä»¶ |
| `src/stores/fastingStore.ts` | æ–°å»º | æ–­é£Ÿç›¸å…³çŠ¶æ€ç®¡ç† |
| `src/components/fasting/FastingCard.tsx` | ä¿®æ”¹ | æ·»åŠ ç»“æŸæ–­é£Ÿé€»è¾‘å’ŒçŠ¶æ€å¼•ç”¨ |
| `src/pages/Index.tsx` | ä¿®æ”¹ | å¼•å…¥æ–°å¼¹å±‚ç»„ä»¶ |
| `src/index.css` | ä¿®æ”¹ | æ·»åŠ æ˜Ÿæ˜Ÿè½ä¸‹åŠ¨ç”» |
| `tailwind.config.ts` | ä¿®æ”¹ | æ·»åŠ åŠ¨ç”»å…³é”®å¸§é…ç½® |

---

## ä¸ƒã€æŠ€æœ¯å®ç°è¦ç‚¹

1. **çº¯ Tailwind å®ç°**ï¼šä¸ä½¿ç”¨ shadcn-ui ç»„ä»¶ï¼Œå…¨éƒ¨ç”¨åŸç”Ÿ div + Tailwind class
2. **å…¨å±å¼¹å±‚**ï¼šä½¿ç”¨ `fixed inset-0` é…åˆ `z-50` å®ç°å…¨å±è¦†ç›–
3. **åº•éƒ¨æŠ½å±‰**ï¼šä½¿ç”¨ `fixed bottom-0 inset-x-0` é…åˆ transform åŠ¨ç”»
4. **æ˜Ÿæ˜ŸåŠ¨ç”»**ï¼šé€šè¿‡ç»å¯¹å®šä½ + CSS animation å®ç°éšæœºè½ä¸‹æ•ˆæœ
5. **Toast æç¤º**ï¼šå¤ç”¨é¡¹ç›®ç°æœ‰çš„ `toast` å‡½æ•°ï¼ˆæ¥è‡ª `@/hooks/use-toast`ï¼‰
6. **å“åº”å¼é€‚é…**ï¼šç§»åŠ¨ç«¯ä¼˜å…ˆï¼Œä½¿ç”¨ `max-w-md mx-auto` çº¦æŸå®½åº¦
